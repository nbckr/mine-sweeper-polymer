<link rel="import" href="../bower_components/polymer/polymer.html"/>
<link rel="import" href="../bower_components/web-socket/web-socket.html"/>
<link rel="import" href="../bower_components/paper-button/paper-button.html"/>
<link rel="import" href="../bower_components/iron-icons/iron-icons.html"/>
<link rel="import" href="../bower_components/iron-overlay-behavior/iron-overlay-behavior.html"/>
<link rel="import" href="../bower_components/polymerfire/firebase-app.html">


<link rel="import" href="minesweeper-grid.html"/>
<link rel="import" href="minesweeper-dialogue.html"/>

<dom-module id="minesweeper-main">

    <style is="custom-style">
        iron-icon {
            margin-right: 5px;
        }

        paper-button.custom {
            --paper-button-ink-color: var(--paper-pink-a200);
            --paper-button-flat-keyboard-focus: {
                background-color: var(--paper-pink-a200);
                color: white !important;
            };
            --paper-button-raised-keyboard-focus: {
                background-color: var(--paper-pink-a200) !important;
                color: white !important;
            };
            margin-bottom: 30px;
        }

        paper-button.custom:hover {
            background-color: var(--paper-indigo-100);
        }

        paper-button.indigo {
            background-color: var(--paper-indigo-500);
            color: white;
            --paper-button-raised-keyboard-focus: {
                background-color: var(--paper-pink-a200) !important;
                color: white !important;
            };
        }

    </style>

    <template>

        <web-socket id="socket" url="wss://minesweeper-htwg.herokuapp.com/socket"
                    auto json
                    on-open="_onWebSocketOpen"
                    on-message="_onWebSocketMessage"
                    on-error="_logWebSocketError"></web-socket>

        <paper-button raised class="custom indigo" on-click="_handleOpenModal">
            <iron-icon icon="add-circle"></iron-icon>
            Start new game
        </paper-button>

        <minesweeper-grid gamedata="{{gamedata}}" id="grid"></minesweeper-grid>

    </template>

    <script>
        Polymer({

            is: 'minesweeper-main',

            properties: {
                gamedata: {
                    type: Object,
                    notify: true
                }
            },

            ready: function () {
                // Prevent context menu
                this.addEventListener('contextmenu', function () {
                    event.preventDefault();
                });
            },

            listeners: {
                'socket-send': '_sendToWebSocket'
            }
            ,

            _onWebSocketOpen: function (event) {
                this.$.socket.send({action: 'touch'});
            },

            _onWebSocketMessage: function (event) {
                this.gamedata = event.detail;
            },

            _logWebSocketError: function (event) {
                console.log('WS Error: ' + event.detail);
            },

            _sendToWebSocket: function (event) {
                event.stopPropagation();
                this.$.socket.send(event.detail);
            }
            ,

            _handleOpenModal: function () {
                this.fire('open-modal');
                this.$.grid._handleOpenModal();
            }

        });

    </script>

</dom-module>