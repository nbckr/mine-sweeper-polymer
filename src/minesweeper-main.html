<link rel="import" href="../bower_components/polymer/polymer.html"/>
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html"/>
<link rel="import" href="minesweeper-grid.html"/>

<dom-module id="minesweeper-main">

    <style>
    </style>

    <template>

        <iron-ajax
                id="ajaxgetter"
                url="http://localhost:9000/game/json"
                method="GET"
                content-type="application/json"
                handle-as="json"
                last-response="{{gamedata}}"
        ></iron-ajax>

        <iron-ajax
                id="ajaxposter"
                url="http://localhost:9000/game/json"
                method="POST"
                content-type="application/json"
                handle-as="json"
                on-response="_refreshGameData"
        ></iron-ajax>

        <minesweeper-grid gamedata="{{gamedata}}"></minesweeper-grid>

    </template>

    <script>
        Polymer({

            is: 'minesweeper-main',

            ready: function () {
                console.log("main: ready");
                this._refreshGameData();
            },

            listeners: {
                'ajax-post': '_handleAjaxPost',
                'server-response': '_refreshGameData'
            },

            _refreshGameData: function () {
                console.log("main: refresh");
                this.$.ajaxgetter.generateRequest();
            },

            _handleAjaxPost: function (event) {
                console.log(event);
                event.stopPropagation();
                this.$.ajaxposter.body = event.detail;
                this.$.ajaxposter.generateRequest();
            }
        });

    </script>

</dom-module>